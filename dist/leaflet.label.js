/*
	Leaflet.MiniMapLayers, a plugin that makes layer switching sexy.
	(c) 2013, Andrew Beaven, Smartrak

	http://leafletjs.com
*/!function(){L.miniMapLayerSwitcherVersion="0.1-dev",L.Control.MiniMapLayerSwitcherVersion=L.Control.extend({_className:"leaflet-mini-map-control-layers",options:{miniMapLabelHeight:20,miniMapHeight:80,miniMapWidth:90,miniMapMargin:10,miniMapZoomOffset:-3,position:"topright",autoZIndex:!0},initialize:function(i,t){L.setOptions(this,t),this._layers={},this._miniMaps={},this._lastZIndex=0;for(var a in i)this._addLayer(i[a],a)},onAdd:function(){return this._render(),this._map.on("move",this._onMapMoved,this).whenReady(this._onMapReady,this),this._container},onRemove:function(){this._map.off("move",this._onMapMoved,this)},_render:function(){var i,t,a=this._container=L.DomUtil.create("div",this._className),e=this._inner=L.DomUtil.create("div",this._className+"-inner");return a.setAttribute("aria-haspopup",!0),L.DomEvent.disableClickPropagation(a),L.Browser.touch?L.DomEvent.on(a,"click",this._toggleMiniMaps,this):L.DomEvent.on(a,"mousewheel",L.DomEvent.stopPropagation).on(a,"mouseenter",this._expand,this).on(a,"mouseleave",this._contract,this),this._forEachLayer(function(i){this._renderMiniMap(i,e)},this),a.style.height=this.options.miniMapHeight+this.options.miniMapLabelHeight+"px",a.appendChild(e),this._hasMultipleLayers()?(i=this._getInitialMainMapLayerId(),t=this._getInitialMiniMapLayerId(i),this._activeLayerId=t,this._switchLayer(i),void 0):(this._container.style.display="none",void 0)},_toggleMiniMaps:function(){var i=L.DomUtil.hasClass(this._container,"expanded");this._animateMiniMaps(!i)},_expand:function(){this._animateMiniMaps(!0)},_contract:function(){this._animateMiniMaps(!1)},_renderMiniMap:function(i,t){var a=this._mapContainer=L.DomUtil.create("div","map-container"),e=L.DomUtil.create("div","map-container-inner"),n=this._mapContainer=L.DomUtil.create("div","map"),s=L.DomUtil.create("div","map-label"),o=i.id,r=this._layers,h=r[o];L.DomEvent.on(a,"click",this._onMiniMapClicked,this),n.style.height=this.options.miniMapHeight+"px",n.style.width=this.options.miniMapWidth+"px",s.innerHTML=i.name,e.appendChild(n),e.appendChild(s),a.layerId=o,a.style.width=this.options.miniMapWidth+"px",a.appendChild(e),t.appendChild(a),this._addMiniMap(o,h.miniMapLayer,n)},_addMiniMap:function(i,t,a){var e=this.options.miniMapZoomOffset,n=this._map.getMinZoom(),s=this._map.getMaxZoom(),o=L.map(a,{dragging:!1,touchZoom:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,trackResize:!1,attributionControl:!1,zoomControl:!1,inertia:!1,worldCopyJump:!1,layers:[t],minZoom:n+e,maxZoom:s+e});this._miniMaps[i]=o},_addLayer:function(i,t){var a,e,n,s=L.stamp(i);if(this._layers[s]={id:s,name:t,mainMapLayer:i},i instanceof L.LayerGroup){e=new L.LayerGroup;for(a in i._layers)n=i._layers[a],n instanceof L.TileLayer&&e.addLayer(new L.TileLayer(n._url,n.options))}else e=new L.TileLayer(i._url,i.options);this._layers[s].miniMapLayer=e,this.options.autoZIndex&&i.setZIndex&&(this._lastZIndex++,i.setZIndex(this._lastZIndex))},_getCurrentTarget:function(i){return i.currentTarget?i.currentTarget:this._getFirstElementWithClass(i.srcElement,"map-container")},_getFirstElementWithClass:function(i,t){var a=L.DomUtil.hasClass(i,t),e=i.parentNode;return a?i:this._getFirstElementWithClass(e,t)},_onMiniMapClicked:function(i){var t,a=this._container,e=this._getCurrentTarget(i),n=e.layerId,s=L.DomUtil.hasClass(this._container,"expanded");s&&n!==this._activeLayerId&&(t=this._layers[n],L.DomUtil.addClass(a,"notransition"),this._switchLayer(n),this._map.fire("baselayerchanged",t.mainMapLayer),L.Util.falseFn(e.offsetWidth),L.DomUtil.removeClass(a,"notransition"))},_switchLayer:function(i){var t,a=this._activeLayerId,e=this._layers[a],n=this._layers[i],s=this._getMiniMapContainer(a),o=this._getMiniMapContainer(i);this._defaultLayerId=a,this._activeLayerId=i,this._forEachLayer(function(i){t=this._getMiniMapContainer(i.id),L.DomUtil.removeClass(t,"active-map"),L.DomUtil.removeClass(t,"default-map")}),L.DomUtil.addClass(o,"active-map"),L.DomUtil.addClass(s,"default-map"),this._map.removeLayer(e.mainMapLayer),this._map.addLayer(n.mainMapLayer)},_animateMiniMaps:function(i){var t,a,e=0,n=this.options.miniMapWidth,s=this.options.miniMapMargin,o=this._container,r=L.DomUtil.hasClass(o,"expanded");r!==i&&(this._forEachLayer(function(o){a=o.id,t=this._getMiniMapContainer(a),this._updateMiniMapPosition(a),i?(t.style.left=e*(n+s)+"px",e++):t.style.left="0"}),i?(o.style.width=(e+1)*(n+s)-s+"px",L.DomUtil.addClass(o,"expanded")):(o.style.width="0",L.DomUtil.removeClass(o,"expanded")))},_getInitialMainMapLayerId:function(){var i,t;return this._forEachLayer(function(a){return i=a.mainMapLayer,this._map.hasLayer(i)?(t=a.id,!1):void 0}),t?t:(this._forEachLayer(function(i){return t=i.id,!1}),t)},_getInitialMiniMapLayerId:function(i){var t,a;return this._forEachLayer(function(e){return t=e.id,t!==i?(a=t,!1):void 0}),a},_forEachLayer:function(i){var t,a,e=this._layers;for(a in e)if(t=e[a],i.call(this,t)===!1)break},_getMiniMapContainer:function(i){var t=this._miniMaps[i];return t.getContainer().parentNode.parentNode},_onMapMoved:function(){var i=this._defaultLayerId,t=L.DomUtil.hasClass(this._container,"expanded");t?this._forEachLayer(function(i){this._updateMiniMapPosition(i.id)},this):this._updateMiniMapPosition(i)},_updateMiniMapPosition:function(i){var t,a,e,n;this._mainMapReady&&this._hasMultipleLayers()&&(t=this._map,a=t.getCenter(),e=t.getZoom()+this.options.miniMapZoomOffset,n=this._miniMaps[i],n.setView(a,e,{pan:{animate:!1},zoom:{animate:!0}}))},_onMapReady:function(){this._mainMapReady=!0},_hasMultipleLayers:function(){var i,t=this._layers,a=0;for(i in t)if(a++,a>1)return!0;return!1}}),L.control.miniMapLayerSwitcher=function(i,t){return new L.Control.MiniMapLayers(i,t)}}(this,document);